<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario de Seguimiento Diario</title>
  <style>
    body { font-family: sans-serif; background: #f7f7f7; padding: 20px; }
    h1 { color: #1f4e79; }
    .bloque { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; background: white; border-radius: 10px; }
    label { display: block; margin-top: 10px; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #1f4e79; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px; }
    button:hover { background: #163d5c; }
  </style>
</head>
<body>
  <h1>Registro de Actividad Andevs</h1>

  <form id="formulario">
    <label for="nombre">Nombre:</label>
    <input type="text" id="nombre" name="nombre" required>

    <div id="bloques"></div>

    <button type="button" onclick="agregarBloque()">+ Agregar bloque</button>
    <button type="submit">Enviar</button>
  </form>

  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbxhN16ru9ticjZJ0LfMNs0mgecbNd0ypmxUGSr16APgGEnBFUG6q8YsR_TetsNeqSPgUw/exec";
    let contador = 0;

    function agregarBloque() {
      contador++;
      const bloqueHTML = `
        <div class="bloque" id="bloque${contador}">
          <h3>Bloque ${contador}</h3>
          <label>Tipo:</label>
          <select name="tipo">
            <option value="Comercial">Comercial</option>
            <option value="Desarrollo">Desarrollo</option>
          </select>

          <label>Cliente:</label>
          <input type="text" name="cliente" required>

          <label>Actividad:</label>
          <select name="actividad">
            <option value="Reunión con potencial cliente">Reunión con potencial cliente</option>
            <option value="Armado de pre propuesta">Armado de pre propuesta</option>
            <option value="Armado de propuesta">Armado de propuesta</option>
            <option value="Creación de contrato">Creación de contrato</option>
            <option value="Seguimiento comercial">Seguimiento comercial</option>
            <option value="Reunión de coordinación comercial">Reunión de coordinación comercial</option>
            <option value="Reunión de avance con cliente">Reunión de avance con cliente</option>
            <option value="Programación / Desarrollo técnico">Programación / Desarrollo técnico</option>
            <option value="Mantención">Mantención</option>
            <option value="Documentación">Documentación</option>
            <option value="Reunión de entrega">Reunión de entrega</option>
            <option value="Otro">Otro (especificar en comentario)</option>
          </select>

          <label>Hora de inicio (HH:MM):</label>
          <input type="time" name="hora_inicio" required>

          <label>Hora de fin (HH:MM):</label>
          <input type="time" name="hora_fin" required>

          <label>Comentario (opcional):</label>
          <textarea name="comentario"></textarea>
        </div>
      `;
      document.getElementById("bloques").insertAdjacentHTML("beforeend", bloqueHTML);
    }

    document.getElementById("formulario").addEventListener("submit", function(e) {
      e.preventDefault();

      const nombre = document.getElementById("nombre").value;
      const bloques = document.querySelectorAll(".bloque");

      bloques.forEach(bloque => {
        const tipo = bloque.querySelector("select[name='tipo']").value;
        const cliente = bloque.querySelector("input[name='cliente']").value;
        const actividad = bloque.querySelector("select[name='actividad']").value;
        const hora_inicio = bloque.querySelector("input[name='hora_inicio']").value;
        const hora_fin = bloque.querySelector("input[name='hora_fin']").value;
        const comentario = bloque.querySelector("textarea[name='comentario']").value;

        const data = {
          nombre,
          tipo,
          cliente,
          actividad,
          hora_inicio,
          hora_fin,
          comentario,
          fecha: new Date().toLocaleDateString("es-CL")
        };

        fetch(endpoint, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
      });

      alert("¡Enviado correctamente!");
      location.reload();
    });
  </script>
</body>
</html>
